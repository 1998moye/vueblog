{"version":3,"sources":["../../../src/directives/click-outside/index.ts"],"names":["attachedRoot","defaultConditional","checkEvent","e","el","binding","checkIsActive","root","ShadowRoot","host","target","elements","value","include","push","some","contains","isActive","closeConditional","directive","handler","_clickOutside","lastMousedownWasOutside","setTimeout","handleShadow","callback","document","body","ClickOutside","mounted","onClick","onMousedown","app","addEventListener","unmounted","removeEventListener"],"mappings":"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","sourcesContent":["import { attachedRoot } from '@/util'\nimport type { DirectiveBinding } from 'vue'\n\ninterface ClickOutsideBindingArgs {\n  handler: (e: MouseEvent) => void\n  closeConditional?: (e: Event) => boolean\n  include?: () => HTMLElement[]\n}\n\ninterface ClickOutsideDirectiveBinding extends DirectiveBinding {\n  value: ((e: MouseEvent) => void) | ClickOutsideBindingArgs\n}\n\nfunction defaultConditional () {\n  return true\n}\n\nfunction checkEvent (e: MouseEvent, el: HTMLElement, binding: ClickOutsideDirectiveBinding): boolean {\n  // The include element callbacks below can be expensive\n  // so we should avoid calling them when we're not active.\n  // Explicitly check for false to allow fallback compatibility\n  // with non-toggleable components\n  if (!e || checkIsActive(e, binding) === false) return false\n\n  // If we're clicking inside the shadowroot, then the app root doesn't get the same\n  // level of introspection as to _what_ we're clicking. We want to check to see if\n  // our target is the shadowroot parent container, and if it is, ignore.\n  const root = attachedRoot(el)\n  if (root instanceof ShadowRoot && root.host === e.target) return false\n\n  // Check if additional elements were passed to be included in check\n  // (click must be outside all included elements, if any)\n  const elements = ((typeof binding.value === 'object' && binding.value.include) || (() => []))()\n  // Add the root element for the component this directive was defined on\n  elements.push(el)\n\n  // Check if it's a click outside our elements, and then if our callback returns true.\n  // Non-toggleable components should take action in their callback and return falsy.\n  // Toggleable can return true if it wants to deactivate.\n  // Note that, because we're in the capture phase, this callback will occur before\n  // the bubbling click event on any outside elements.\n  return !elements.some(el => el.contains(e.target as Node))\n}\n\nfunction checkIsActive (e: MouseEvent, binding: ClickOutsideDirectiveBinding): boolean | void {\n  const isActive = (typeof binding.value === 'object' && binding.value.closeConditional) || defaultConditional\n\n  return isActive(e)\n}\n\nfunction directive (e: MouseEvent, el: HTMLElement, binding: ClickOutsideDirectiveBinding) {\n  const handler = typeof binding.value === 'function' ? binding.value : binding.value.handler\n\n  el._clickOutside!.lastMousedownWasOutside && checkEvent(e, el, binding) && setTimeout(() => {\n    checkIsActive(e, binding) && handler && handler(e)\n  }, 0)\n}\n\nfunction handleShadow (el: HTMLElement, callback: Function): void {\n  const root = attachedRoot(el)\n\n  callback(document.body)\n\n  if (root instanceof ShadowRoot) {\n    callback(root)\n  }\n}\n\nexport const ClickOutside = {\n  // [data-app] may not be found\n  // if using bind, inserted makes\n  // sure that the root element is\n  // available, iOS does not support\n  // clicks on body\n  mounted (el: HTMLElement, binding: ClickOutsideDirectiveBinding) {\n    const onClick = (e: Event) => directive(e as MouseEvent, el, binding)\n    const onMousedown = (e: Event) => {\n      el._clickOutside!.lastMousedownWasOutside = checkEvent(e as MouseEvent, el, binding)\n    }\n\n    handleShadow(el, (app: HTMLElement) => {\n      app.addEventListener('click', onClick, true)\n      app.addEventListener('mousedown', onMousedown, true)\n    })\n\n    el._clickOutside = {\n      lastMousedownWasOutside: true,\n      onClick,\n      onMousedown,\n    }\n  },\n\n  unmounted (el: HTMLElement) {\n    if (!el._clickOutside) return\n\n    handleShadow(el, (app: HTMLElement) => {\n      if (!app || !el._clickOutside) return\n      app.removeEventListener('click', el._clickOutside.onClick, true)\n      app.removeEventListener('mousedown', el._clickOutside.onMousedown, true)\n    })\n\n    delete el._clickOutside\n  },\n}\n\nexport default ClickOutside\n"],"file":"index.mjs"}