{"version":3,"sources":["../../../src/components/VForm/VForm.ts"],"names":["mixins","BindsAttrs","provide","RegistrableProvide","extend","name","form","inheritAttrs","props","disabled","Boolean","lazyValidation","readonly","value","data","inputs","watchers","errorBag","watch","handler","val","errors","Object","values","includes","$emit","deep","immediate","methods","watchInput","input","watcher","$watch","$set","_uid","valid","shouldValidate","hasOwnProperty","validate","filter","length","reset","forEach","resetErrorBag","setTimeout","resetValidation","register","push","unregister","found","find","i","unwatch","$delete","render","h","staticClass","attrs","novalidate","attrs$","on","submit","e","$slots","default"],"mappings":"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","sourcesContent":["// @ts-nocheck\n/* eslint-disable */\n\n// Components\nimport VInput from '../VInput/VInput'\n\n// Mixins\nimport mixins from '../../util/mixins'\nimport BindsAttrs from '../../mixins/binds-attrs'\nimport { provide as RegistrableProvide } from '../../mixins/registrable'\n\n// Helpers\nimport { VNode } from 'vue'\n\ntype ErrorBag = Record<number, boolean>\ntype VInputInstance = InstanceType<typeof VInput>\ntype Watchers = {\n  _uid: number\n  valid: () => void\n  shouldValidate: () => void\n}\n\n/* @vue/component */\nexport default mixins(\n  BindsAttrs,\n  RegistrableProvide('form')\n  /* @vue/component */\n).extend({\n  name: 'v-form',\n\n  provide (): object {\n    return { form: this }\n  },\n\n  inheritAttrs: false,\n\n  props: {\n    disabled: Boolean,\n    lazyValidation: Boolean,\n    readonly: Boolean,\n    value: Boolean,\n  },\n\n  data: () => ({\n    inputs: [] as VInputInstance[],\n    watchers: [] as Watchers[],\n    errorBag: {} as ErrorBag,\n  }),\n\n  watch: {\n    errorBag: {\n      handler (val) {\n        const errors = Object.values(val).includes(true)\n\n        this.$emit('input', !errors)\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n\n  methods: {\n    watchInput (input: any): Watchers {\n      const watcher = (input: any): (() => void) => {\n        return input.$watch('hasError', (val: boolean) => {\n          this.$set(this.errorBag, input._uid, val)\n        }, { immediate: true })\n      }\n\n      const watchers: Watchers = {\n        _uid: input._uid,\n        valid: () => {},\n        shouldValidate: () => {},\n      }\n\n      if (this.lazyValidation) {\n        // Only start watching inputs if we need to\n        watchers.shouldValidate = input.$watch('shouldValidate', (val: boolean) => {\n          if (!val) return\n\n          // Only watch if we're not already doing it\n          if (this.errorBag.hasOwnProperty(input._uid)) return\n\n          watchers.valid = watcher(input)\n        })\n      } else {\n        watchers.valid = watcher(input)\n      }\n\n      return watchers\n    },\n    /** @public */\n    validate (): boolean {\n      return this.inputs.filter(input => !input.validate(true)).length === 0\n    },\n    /** @public */\n    reset (): void {\n      this.inputs.forEach(input => input.reset())\n      this.resetErrorBag()\n    },\n    resetErrorBag () {\n      if (this.lazyValidation) {\n        // Account for timeout in validatable\n        setTimeout(() => {\n          this.errorBag = {}\n        }, 0)\n      }\n    },\n    /** @public */\n    resetValidation () {\n      this.inputs.forEach(input => input.resetValidation())\n      this.resetErrorBag()\n    },\n    register (input: VInputInstance) {\n      this.inputs.push(input)\n      this.watchers.push(this.watchInput(input))\n    },\n    unregister (input: VInputInstance) {\n      const found = this.inputs.find(i => i._uid === input._uid)\n\n      if (!found) return\n\n      const unwatch = this.watchers.find(i => i._uid === found._uid)\n      if (unwatch) {\n        unwatch.valid()\n        unwatch.shouldValidate()\n      }\n\n      this.watchers = this.watchers.filter(i => i._uid !== found._uid)\n      this.inputs = this.inputs.filter(i => i._uid !== found._uid)\n      this.$delete(this.errorBag, found._uid)\n    },\n  },\n\n  render (h): VNode {\n    return h('form', {\n      staticClass: 'v-form',\n      attrs: {\n        novalidate: true,\n        ...this.attrs$,\n      },\n      on: {\n        submit: (e: Event) => this.$emit('submit', e),\n      },\n    }, this.$slots.default)\n  },\n})\n"],"file":"VForm.mjs"}